# 扩展主题的个性化设置-3

## 1.添加valine评论

详见博客：[hexo+yilia添加valine评论](https://www.yansheng.xyz/2019/08/16/2019-08-16-hexo-valine/)


## 2.添加hexo-neat插件--压缩页面静态资源

详见博客：[Hexo瞎折腾系列(5) - 使用hexo-neat插件压缩页面静态资源](https://blog.csdn.net/lewky_liu/article/details/82432003)


### 2.1安装

#### 2.1.1安装hexo-neat插件

在站点根目录下安装hexo-neat
```bash
npm install hexo-neat --save
```


#### 2.1.2配置

直接添加到站点配置文件`hexo\_config.yml`的末尾就可以
```yml
# hexo-neat
# 博文压缩
neat_enable: true
# 压缩html
neat_html:
  enable: true
  exclude:
# 压缩css  
neat_css:
  enable: true
  exclude:
    - '**/*.min.css'
# 压缩js
neat_js:
  enable: true
  mangle: true
  output:
  compress:
  exclude:
    - '**/*.min.js'
    - '**/jquery.fancybox.pack.js'
    - '**/index.js'  
```


### 2.2第一次发布时的效果：

`32 files changed, 768 insertions(+), 23449 deletions(-)`

删除了23449行，添加了 768行代码，也就是大概压缩了22681‬行代码，效果很不错。但是这可能存在一个问题：一行可能会很长、有很多代码，然而这没什么所谓，因为没人会看这个……

**我们要关注的仅仅是我们自己写的markdown博文，我们要看的是生成的静态的HTML页面，而不是中间产物HTML代码。**



## 3.修复微信分享二维码失效的问题

参考：

- https://github.com/litten/hexo-theme-yilia/issues/776#issuecomment-417163358

- https://github.com/litten/hexo-theme-yilia/issues/769#issuecomment-399623539

---

修改：`themes/yilia/layout/_partial/post/share.ejs`文件中的区域：

```ejs
<div class="wx-qrcode">
      <img src="<%- 'qrcode' in locals ? qrcode(sUrl) : '//pan.baidu.com/share/qrcode?url=' + sUrl  %>" alt="微信分享二维码">
    </div>
```

把其中的`'//pan.baidu.com/share/qrcode?url='`换成`'http://qr.liantu.com/api.php?text='`。



## 4.添加百度推送

参考：<https://blog.csdn.net/linzhiqiang0316/article/details/89344595>

百度官方介绍：<https://ziyuan.baidu.com/college/articleinfo?id=1504>

---
bug:提交推送链接后，百度好像有延迟，你不能立即看到提交数据的变化。



### 4.1介绍


#### 4.1.1SEO优化

推广是一个烦人的事情，特别是对于我们搞技术的来说，可能就不擅长推广，那么怎么才能让别人知道我们呢，我们就要想办法让别人通过搜索就可以搜索到你博客的内容，给我们带来自然流量，这就需要seo优化,让我们的站点变得对搜索引擎友好。

> SEO是由英文Search Engine Optimization缩写而来， 中文意译为“搜索引擎优化”。SEO是指通过站内优化比如网站结构调整、网站内容建设、网站代码优化等以及站外优化。

#### 4.1.2如何选择链接提交方式 ？

1. 手动提交：一次性提交链接给百度，可以使用此种方式。

2. 自动提交（虽然这种方式各有千秋，但是百度推荐全用上，全面一点！）：
	2.1 主动推送（实时）：最为快速的提交方式，推荐您将站点当天新产出链接立即通过此方式推送给百度，以保证新链接可以及时被百度收录。 

	2.2 自动推送：最为便捷的提交方式，请将自动推送的JS代码部署在站点的每一个页面源代码中，部署代码的页面在每次被浏览时，链接会被自动推送给百度。可以与主动推送配合使用。 

	2.3 sitemap：您可以定期将网站链接放到sitemap中，然后将sitemap提交给百度。百度会周期性的抓取检查您提交的sitemap，对其中的链接进行处理，但收录速度慢于主动推送。

### 4.2设置推送

前提：注册百度，添加站点。

#### 4.2.1主动推送
参考：[Hexo插件之百度主动提交链接](https://hui-wang.info/2016/10/23/Hexo%E6%8F%92%E4%BB%B6%E4%B9%8B%E7%99%BE%E5%BA%A6%E4%B8%BB%E5%8A%A8%E6%8F%90%E4%BA%A4%E9%93%BE%E6%8E%A5/)


##### 4.2.1.1前提：获得秘钥

您得注册百度站长工具，然后在**（标题栏）网站支持->数据引入->链接提交**里找到你的密匙。
![img](https://hui-wang.info/2016/10/23/Hexo%E6%8F%92%E4%BB%B6%E4%B9%8B%E7%99%BE%E5%BA%A6%E4%B8%BB%E5%8A%A8%E6%8F%90%E4%BA%A4%E9%93%BE%E6%8E%A5/token.png)

##### 4.2.1.2添加插件hexo-baidu-url-submit

该插件github网址：<https://github.com/huiwang/hexo-baidu-url-submit>

首先，在Hexo根目录下，安装本插件：
`npm install hexo-baidu-url-submit --save`


##### 4.2.1.3配置“百度主动推送”

然后，同样在根目录下，把以下内容配置到`_config.yml`文件中:

```
# 百度主动推送
baidu_url_submit:
  count: 1 ## 提交最新的一个链接
  host: www.hui-wang.info ## 在百度站长平台中注册的域名
  token: your_token ## 请注意这是您的秘钥， 所以请不要把博客源代码发布在公众仓库里!
  path: baidu_urls.txt ## 文本文档的地址， 新链接会保存在此文本文档里
```

其次，记得查看_config.ym文件中url的值， 必须包含是百度站长平台注册的域名（一般有www）， 比如:

```
# URL
url: http://www.hui-wang.info
root: /
permalink: :year/:month/:day/:title/
```


最后，加入新的deployer:

```
deploy:
- type: s3 ## 这是我原来的deployer
  bucket: hui-wang.info
- type: baidu_url_submitter ## 这是新加的
```

注意：上面是官方的文档，而实际上应该要这样，可参考我的：

```yml
deploy:
- type: git
  repository: 
     github: https://github.com/yansheng836/yansheng836.github.io.git
     coding: https://git.dev.tencent.com/yansheng836/yansheng836.coding.me.git
  branch: master
  # 发布时，同时进行百度推送
- type: baidu_url_submitter
```

因为不是有两个deploy，要放在一起。


##### 4.2.1.4如何进行推送

执行`hexo deploy`的时候，新的连接就会被推送了。如下图

![mnv2AU.jpg](https://s2.ax1x.com/2019/08/17/mnv2AU.jpg)

查看官网信息(如下所示)我们可以知道这是推送成功了。

补充：官网信息查看方式**（标题栏）网站支持->数据引入->链接提交->自动提交->主动推送**，在下面就由推送成功的信息（如下）。

```
#成功返回示例：
{
    "remain":4999998,
    "success":2,
    "not_same_site":[],
    "not_valid":[]
}
```

我们可以发现在`public\`目录下生成有`baidu_urls.txt`里面的就是推送的链接。



#### 4.2.2自动推送

参考：<https://purewhite.io/2017/04/29/hexo-baidu-url-submit/>

<https://github.com/JoeyBling/hexo-theme-yilia-plus/commit/c1215e132f6d5621c5fea83d3c4f7ccbcca074a3>

1. 在配置`H:\Hexo\themes\yilia\_config.yml`中开启功能：
```yml
# 开启百度站长平台自动推送(https://ziyuan.baidu.com/linksubmit/index)
# 页面被访问了，就会被推送过去。
baidu_push: true
```

2. 新建`H:\Hexo\themes\yilia\layout\_partial\baidu-push.ejs`：
```ejs
<% if (theme.baidu_push){ %>
<!-- 开启百度站长平台自动推送https://ziyuan.baidu.com/linksubmit/index，
https://ziyuan.baidu.com/college/courseinfo?id=267&page=2#h2_article_title19-->
<script>
  (function () {
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
      bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    } else {
      bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
  })();
</script>
<% } %>
```

3. 在`H:\Hexo\themes\yilia\layout\_partial\head.ejs`的`</head>`前引入脚本：
```ejs
<!--百度自动推送-->
<%- partial('baidu-push') %>
</head>
```



#### 4.2.3sitemap

参考博客:https://purewhite.io/2017/04/29/hexo-baidu-url-submit/

我们使用 `hexo generator-baidu-sitemap`这个插件，github：<https://github.com/coneycode/hexo-generator-baidu-sitemap>


#### 4.2.3.1安装`hexo generator-baidu-sitemap`插件

```bash
#if your hexo version is 2.x.x, you should install as follow:
$ npm install hexo-generator-baidu-sitemap@0.0.8 --save

#if version is 3.x.x, you should install as follow:
$ npm install hexo-generator-baidu-sitemap --save
```

#### 4.2.3.2然后在`_config.yml` 里面配置一下：

```
baidusitemap:
  path: baidusitemap.xml
```

`hexo g`后，会在`public\`目录下生成站点文件`baidusitemap.xml`。

#### 4.2.3.3百度站长平台设置

之后去百度站长平台提交一下 sitemap 的路径就好，一般都是 `www.example.com/baidusitemap.xml`。